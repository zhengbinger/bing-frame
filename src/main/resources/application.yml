# 应用名称
spring:
  application:
    name: bing-framework

# Knife4j配置
knife4j:
  enable: true
  setting:
    # 语言设置为中文
    language: zh-CN
    # 显示请求参数缓存
    enable-request-cache: true
    # 开启登录认证
    enable-security: false
    # 忽略参数属性（Spring Security相关）
    ignore-parameters: 
      - token
      - Authorization
  # 增强功能配置
  enhancement:
    # 启用接口排序
    enable-order: true
    # 启用返回参数缓存
    enable-response-cache: true
  profiles:
    active: dev  # 默认使用开发环境
  
  # 国际化配置
  messages:
    basename: i18n/messages
    encoding: UTF-8
    fallback-to-system-locale: false
    default-locale: zh_CN
    cache-duration: 60s
  
  # JWT配置
  jwt:
    secret: bing-framework-jwt-secret-key-2025
    expiration: 24  # 过期时间（小时）
  
  # MVC配置
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher
    cors:
      allowed-origins: '*'
      allowed-methods: GET,POST,PUT,DELETE,OPTIONS
      allowed-headers: '*'
      max-age: 3600
  
  # 数据库连接池配置
  datasource:
    url: jdbc:mysql://localhost:3306/bing?useUnicode=true&characterEncoding=UTF-8&serverTimezone=Asia/Shanghai
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      pool-name: BingFrameworkHikariCP
      validation-timeout: 5000
      leak-detection-threshold: 60000
  
  # 缓存配置 - 使用本地Redis缓存
  redis:
    host: 127.0.0.1
    port: 6379
    password: 
    database: 0
    timeout: 60000
    lettuce:
      pool:
        max-active: 8
        max-wait: -1
        max-idle: 8
        min-idle: 0
  cache:
    type: redis
    cache-names: auditLogCache,userCache,whiteListCache
    redis:
      time-to-live: 3600000  # 缓存过期时间（毫秒）
      key-prefix: "bing:"
      cache-null-values: false
      use-key-prefix: true
      enable-statistics: true
  
  # 异步任务配置
  task:
    execution:
      pool:
        core-size: 10
        max-size: 50
        queue-capacity: 1000
        keep-alive: 60s
        thread-name-prefix: audit-log-executor-
      # 启用任务执行的优雅关闭
      shutdown:
        await-termination: true
        await-termination-period: 60s
  
  # 额外的Spring配置
  main:
    allow-bean-definition-overriding: true
    # 启用全局懒加载，提升启动性能
    lazy-initialization: true
    # 指定Web应用类型
    web-application-type: servlet
    # 启用Bean的并行初始化
    # 在Spring Boot 2.4+中使用application-startup配置
    # 暂时注释，避免版本兼容性问题
    # application-startup: default

# 服务器配置
server:
  port: 8081
  servlet:
    # context-path: /api
    session:
      timeout: 30m
  tomcat:
    uri-encoding: UTF-8
    max-connections: 10000
    threads:
      max: 200
      min-spare: 10
    connection-timeout: 20000

# MyBatis配置
mybatis:
  mapper-locations: classpath:mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true
    default-fetch-size: 100
    default-statement-timeout: 30
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
  global-config:
    db-config:
      id-type: AUTO
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# 日志配置 - 更详细的日志设置
logging:
  level:
    root: INFO
    com.bing.framework: INFO
    org.springframework: WARN
    org.hibernate: WARN
    org.apache.ibatis: WARN
    org.apache.tomcat: WARN
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n'
  file:
    name: logs/bing-framework.log
    max-size: 10MB
    max-history: 7

# API文档工具已移除

# 自定义配置
app:
  # 应用相关配置
  name: ${spring.application.name}
  version: 1.0.0
  # 安全配置
  security:
    token:
      expire-time: 7200
      secret: your-secret-key-here
  # 审计日志配置
  audit:
    enabled: true
    async-enabled: true