<svg xmlns="http://www.w3.org/2000/svg" width="900" height="600" viewBox="0 0 900 600">
  <!-- 定义样式 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <style>
      .component {
        fill: #f0f7ff;
        stroke: #2c7ad6;
        stroke-width: 2;
        rx: 8;
        ry: 8;
      }
      .sub-component {
        fill: #fff7e6;
        stroke: #ff8c00;
        stroke-width: 1;
        rx: 5;
        ry: 5;
      }
      .service {
        fill: #e6fff0;
        stroke: #00a86b;
        stroke-width: 1;
        rx: 5;
        ry: 5;
      }
      .database {
        fill: #fff0ff;
        stroke: #9d4edd;
        stroke-width: 1;
        rx: 20;
        ry: 20;
      }
      .interface {
        fill: #ffe6e6;
        stroke: #ff6b6b;
        stroke-width: 1;
        rx: 5;
        ry: 5;
        stroke-dasharray: 5,3;
      }
      .component-title {
        font-weight: bold;
        font-size: 14px;
        text-anchor: middle;
        fill: #000;
      }
      .text {
        font-size: 12px;
        text-anchor: middle;
        fill: #000;
      }
      .title {
        font-size: 20px;
        font-weight: bold;
        text-anchor: middle;
        fill: #000;
      }
      .arrow {
        stroke: #333;
        stroke-width: 1.5;
        marker-end: url(#arrowhead);
      }
      .legend-item {
        font-size: 12px;
        fill: #000;
      }
      .note {
        font-size: 11px;
        fill: #666;
        text-anchor: middle;
      }
      /* 确保没有黑色底块 */
      * {
        fill-opacity: 1;
        stroke-opacity: 1;
      }
    </style>
  </defs>

  <!-- 标题 -->
  <text x="450" y="30" class="title">数据权限管理系统架构图</text>

  <!-- 应用层 -->
  <rect x="100" y="80" width="700" height="80" class="component" />
  <text x="450" y="100" class="component-title">应用层</text>
  <rect x="120" y="110" width="180" height="30" class="sub-component" />
  <text x="210" y="125" class="text">Controller</text>
  <rect x="320" y="110" width="180" height="30" class="sub-component" />
  <text x="410" y="125" class="text">Service</text>
  <rect x="520" y="110" width="180" height="30" class="sub-component" />
  <text x="610" y="125" class="text">Data Access Layer</text>

  <!-- 数据权限核心层 -->
  <rect x="100" y="200" width="700" height="120" class="component" />
  <text x="450" y="220" class="component-title">数据权限核心层</text>
  
  <rect x="120" y="240" width="160" height="30" class="service" />
  <text x="200" y="255" class="text">DataPermissionService</text>
  
  <rect x="300" y="240" width="160" height="30" class="interface" />
  <text x="380" y="255" class="text">DataPermissionResolver</text>
  
  <rect x="480" y="240" width="160" height="30" class="service" />
  <text x="560" y="255" class="text">DataPermissionCache</text>
  
  <rect x="120" y="290" width="160" height="30" class="service" />
  <text x="200" y="305" class="text">DataPermissionInterceptor</text>
  
  <rect x="300" y="290" width="160" height="30" class="service" />
  <text x="380" y="305" class="text">ResolverRegistry</text>
  
  <rect x="480" y="290" width="160" height="30" class="interface" />
  <text x="560" y="305" class="text">扩展点接口</text>

  <!-- 基础架构层 -->
  <rect x="100" y="350" width="700" height="100" class="component" />
  <text x="450" y="370" class="component-title">基础架构层</text>
  
  <rect x="140" y="390" width="140" height="40" class="service" />
  <text x="210" y="405" class="text">Spring Security</text>
  <text x="210" y="425" class="text">集成</text>
  
  <rect x="320" y="390" width="140" height="40" class="service" />
  <text x="390" y="405" class="text">MyBatis-Plus</text>
  <text x="390" y="425" class="text">集成</text>
  
  <rect x="500" y="390" width="140" height="40" class="service" />
  <text x="570" y="405" class="text">Redis缓存</text>
  <text x="570" y="425" class="text">管理</text>

  <!-- 数据存储层 -->
  <rect x="100" y="480" width="700" height="80" class="component" />
  <text x="450" y="500" class="component-title">数据存储层</text>
  
  <rect x="140" y="520" width="140" height="40" class="database" />
  <text x="210" y="540" class="text">data_permission表</text>
  
  <rect x="320" y="520" width="140" height="40" class="database" />
  <text x="390" y="540" class="text">role_data_permission表</text>
  
  <rect x="500" y="520" width="140" height="40" class="database" />
  <text x="570" y="540" class="text">与RBAC相关表</text>

  <!-- 箭头连接 -->
  <!-- 应用层到核心层 -->
  <line x1="210" y1="140" x2="210" y2="240" class="arrow" />
  <line x1="410" y1="140" x2="410" y2="240" class="arrow" />
  <line x1="610" y1="140" x2="610" y2="240" class="arrow" />
  
  <!-- 核心层到基础架构层 -->
  <line x1="200" y1="320" x2="200" y2="390" class="arrow" />
  <line x1="380" y1="320" x2="380" y2="390" class="arrow" />
  <line x1="560" y1="320" x2="560" y2="390" class="arrow" />
  
  <!-- 基础架构层到数据存储层 -->
  <line x1="210" y1="430" x2="210" y2="520" class="arrow" />
  <line x1="390" y1="430" x2="390" y2="520" class="arrow" />
  <line x1="570" y1="430" x2="570" y2="520" class="arrow" />

  <!-- 图例 -->
  <rect x="50" y="520" width="15" height="10" fill="#f0f7ff" stroke="#2c7ad6" stroke-width="2" rx="2" ry="2" />
  <text x="70" y="530" class="legend-item" text-anchor="start">层级</text>
  
  <rect x="50" y="540" width="15" height="10" fill="#e6fff0" stroke="#00a86b" stroke-width="1" rx="2" ry="2" />
  <text x="70" y="550" class="legend-item" text-anchor="start">服务组件</text>
  
  <rect x="50" y="560" width="15" height="10" fill="#ffe6e6" stroke="#ff6b6b" stroke-width="1" rx="2" ry="2" stroke-dasharray="3,2" />
  <text x="70" y="570" class="legend-item" text-anchor="start">接口</text>
  
  <rect x="50" y="580" width="15" height="10" fill="#fff0ff" stroke="#9d4edd" stroke-width="1" rx="5" ry="5" />
  <text x="70" y="590" class="legend-item" text-anchor="start">数据存储</text>

  <!-- 说明 -->
  <text x="750" y="50" class="note">数据权限管理系统采用分层架构设计，与现有RBAC权限体系和</text>
  <text x="750" y="65" class="note">组织管理模块无缝集成，支持多种数据权限类型和灵活的扩展机制。</text>

  <!-- 权限流程说明 -->
  <rect x="700" y="350" width="180" height="120" fill="#f9f9f9" stroke="#ccc" stroke-width="1" rx="5" ry="5" />
  <text x="790" y="370" class="component-title" font-size="12" fill="#666">权限控制流程</text>
  <text x="710" y="390" font-size="11" fill="#666">1. 功能权限验证</text>
  <text x="710" y="410" font-size="11" fill="#666">2. 获取数据权限规则</text>
  <text x="710" y="430" font-size="11" fill="#666">3. 生成数据过滤条件</text>
  <text x="710" y="450" font-size="11" fill="#666">4. 应用SQL动态过滤</text>
  <text x="710" y="470" font-size="11" fill="#666">5. 返回权限范围内数据</text>
</svg>