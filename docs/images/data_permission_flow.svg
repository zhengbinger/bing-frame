<svg xmlns="http://www.w3.org/2000/svg" width="900" height="500" viewBox="0 0 900 500">
  <!-- 定义样式 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
    <style>
      .process {
        fill: #e6f3ff;
        stroke: #333;
        stroke-width: 1;
        rx: 10;
        ry: 10;
      }
      .decision {
        fill: #fff2cc;
        stroke: #333;
        stroke-width: 1;
      }
      .start {
        fill: #d4edda;
        stroke: #333;
        stroke-width: 1;
        rx: 20;
        ry: 20;
      }
      .end {
        fill: #f8d7da;
        stroke: #333;
        stroke-width: 1;
        rx: 20;
        ry: 20;
      }
      .text {
        font-size: 14px;
        text-anchor: middle;
        dominant-baseline: middle;
      }
      .arrow {
        stroke: #333;
        stroke-width: 1.5;
        marker-end: url(#arrowhead);
      }
      .title {
        font-size: 18px;
        font-weight: bold;
        text-anchor: middle;
      }
      .note {
        font-size: 12px;
        fill: #666;
        text-anchor: middle;
      }
    </style>
  </defs>

  <!-- 标题 -->
  <text x="450" y="30" class="title">数据权限验证流程图</text>

  <!-- 开始节点 -->
  <rect x="400" y="70" width="100" height="50" class="start" />
  <text x="450" y="95" class="text">请求开始</text>

  <!-- 功能权限验证 -->
  <rect x="350" y="150" width="200" height="60" class="process" />
  <text x="450" y="180" class="text">功能权限验证</text>
  
  <!-- 功能权限判断 -->
  <polygon points="450,240 425,290 475,290" class="decision" />
  <text x="450" y="275" class="text">有权限?</text>
  
  <!-- 无权限结束 -->
  <rect x="250" y="340" width="100" height="50" class="end" />
  <text x="300" y="365" class="text">返回无权限</text>
  
  <!-- 获取数据权限 -->
  <rect x="350" y="340" width="200" height="60" class="process" />
  <text x="450" y="370" class="text">获取用户数据权限</text>
  
  <!-- 缓存检查 -->
  <polygon points="450,430 425,480 475,480" class="decision" />
  <text x="450" y="465" class="text">缓存命中?</text>
  
  <!-- 从数据库获取 -->
  <rect x="600" y="340" width="200" height="60" class="process" />
  <text x="700" y="370" class="text">从数据库获取</text>
  
  <!-- 生成过滤条件 -->
  <rect x="600" y="220" width="200" height="60" class="process" />
  <text x="700" y="250" class="text">生成SQL过滤条件</text>
  
  <!-- 应用过滤条件 -->
  <rect x="600" y="120" width="200" height="60" class="process" />
  <text x="700" y="150" class="text">应用数据权限过滤</text>
  
  <!-- 执行SQL查询 -->
  <rect x="600" y="50" width="200" height="50" class="end" />
  <text x="700" y="75" class="text">执行SQL查询</text>

  <!-- 箭头连接 -->
  <!-- 开始到功能权限验证 -->
  <line x1="450" y1="120" x2="450" y2="150" class="arrow" />
  
  <!-- 功能权限验证到判断 -->
  <line x1="450" y1="210" x2="450" y2="240" class="arrow" />
  
  <!-- 判断到无权限 -->
  <line x1="437.5" y1="290" x2="300" y2="340" class="arrow" />
  <text x="350" y="310" class="note">否</text>
  
  <!-- 判断到获取数据权限 -->
  <line x1="450" y1="290" x2="450" y2="340" class="arrow" />
  <text x="470" y="315" class="note">是</text>
  
  <!-- 获取数据权限到缓存检查 -->
  <line x1="450" y1="400" x2="450" y2="430" class="arrow" />
  
  <!-- 缓存检查到从数据库获取 -->
  <line x1="462.5" y1="480" x2="700" y2="400" class="arrow" />
  <text x="580" y="450" class="note">否</text>
  
  <!-- 缓存检查到生成过滤条件(直接命中) -->
  <line x1="450" y1="430" x2="700" y2="280" class="arrow" />
  
  <!-- 从数据库获取到生成过滤条件 -->
  <line x1="700" y1="400" x2="700" y2="280" class="arrow" />
  
  <!-- 生成过滤条件到应用过滤条件 -->
  <line x1="700" y1="280" x2="700" y2="180" class="arrow" />
  
  <!-- 应用过滤条件到执行SQL查询 -->
  <line x1="700" y1="180" x2="700" y2="100" class="arrow" />

  <!-- 说明框 -->
  <rect x="100" y="120" width="180" height="330" rx="5" ry="5" fill="#f9f9f9" stroke="#ccc" stroke-width="1" />
  <text x="190" y="150" class="title" font-size="14" fill="#666">权限验证关键点</text>
  <text x="110" y="180" font-size="12" fill="#666">• 功能权限优先验证</text>
  <text x="110" y="210" font-size="12" fill="#666">• 数据权限多级缓存</text>
  <text x="110" y="240" font-size="12" fill="#666">• 支持多种权限类型</text>
  <text x="110" y="270" font-size="12" fill="#666">• SQL动态过滤</text>
  <text x="110" y="300" font-size="12" fill="#666">• 权限合并策略</text>
  <text x="110" y="330" font-size="12" fill="#666">• 性能优化设计</text>
  <text x="110" y="360" font-size="12" fill="#666">• 可扩展性考虑</text>
  <text x="110" y="390" font-size="12" fill="#666">• 安全审计支持</text>
  <text x="110" y="420" font-size="12" fill="#666">• 与RBAC集成</text>
</svg>