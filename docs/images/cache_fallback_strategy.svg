<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <!-- 定义样式 -->
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; fill: #333; }
      .subtitle { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #555; }
      .component { font-family: Arial, sans-serif; font-size: 12px; fill: #fff; text-anchor: middle; }
      .label { font-family: Arial, sans-serif; font-size: 11px; fill: #666; }
      .arrow { stroke: #2196F3; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .arrow-red { stroke: #F44336; stroke-width: 2; fill: none; marker-end: url(#arrowhead-red); }
      .arrow-green { stroke: #4CAF50; stroke-width: 2; fill: none; marker-end: url(#arrowhead-green); }
      .redis { fill: #FF5722; }
      .local { fill: #2196F3; }
      .monitor { fill: #607D8B; }
      .alert { fill: #FF9800; }
      .success { fill: #4CAF50; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2196F3" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#F44336" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4CAF50" />
    </marker>
  </defs>
  
  <!-- 标题 -->
  <text x="400" y="25" text-anchor="middle" class="title">缓存降级策略流程图</text>
  
  <!-- 监控组件 -->
  <rect x="325" y="60" width="150" height="50" class="monitor" rx="5"/>
  <text x="400" y="85" text-anchor="middle" class="component">缓存健康监控</text>
  <text x="400" y="100" text-anchor="middle" class="label">每30秒检查一次</text>
  
  <!-- 失败计数 -->
  <rect x="325" y="140" width="150" height="40" class="alert" rx="5"/>
  <text x="400" y="165" text-anchor="middle" class="component">失败计数器</text>
  <text x="400" y="180" text-anchor="middle" class="label">当前失败: <tspan id="failureCount">0</tspan></text>
  
  <!-- 降级判断 -->
  <polygon points="400,220 450,245 400,270 350,245" class="alert"/>
  <text x="400" y="248" text-anchor="middle" class="component">失败次数 >= 3?</text>
  
  <!-- 降级触发 -->
  <text x="490" y="245" class="label">是</text>
  <path d="M 450 245 L 520 245 L 520 280 L 540 280" class="arrow-red"/>
  <rect x="540" y="270" width="120" height="50" class="local" rx="5"/>
  <text x="600" y="290" text-anchor="middle" class="component">触发降级</text>
  <text x="600" y="305" text-anchor="middle" class="label">切换到本地缓存</text>
  
  <!-- 继续监控 -->
  <text x="350" y="245" class="label">否</text>
  <path d="M 370 245 L 320 245 L 320 80" class="arrow"/>
  
  <!-- 记录降级 -->
  <rect x="540" y="350" width="120" height="40" class="alert" rx="5"/>
  <text x="600" y="375" text-anchor="middle" class="component">记录降级状态</text>
  
  <!-- 日志记录 -->
  <rect x="540" y="420" width="120" height="40" class="monitor" rx="5"/>
  <text x="600" y="445" text-anchor="middle" class="component">输出降级日志</text>
  
  <!-- 继续监控本地 -->
  <path d="M 600 320 L 600 350" class="arrow-red"/>
  <path d="M 600 390 L 600 420" class="arrow-red"/>
  <path d="M 600 460 L 600 490 L 400 490 L 400 510" class="arrow"/>
  
  <!-- 状态显示 -->
  <rect x="100" y="270" width="120" height="80" fill="#f5f5f5" rx="5"/>
  <text x="160" y="290" text-anchor="middle" class="subtitle">当前状态</text>
  <rect x="120" y="300" width="80" height="20" class="success" rx="3"/>
  <text x="160" y="315" text-anchor="middle" class="component">Redis模式</text>
  
  <rect x="120" y="330" width="80" height="20" class="local" rx="3"/>
  <text x="160" y="345" text-anchor="middle" class="component">本地模式</text>
  
  <!-- 自动恢复检查 -->
  <polygon points="400,560 450,585 400,610 350,585" class="success"/>
  <text x="400" y="588" text-anchor="middle" class="component">Redis恢复?</text>
  
  <!-- 恢复触发 -->
  <text x="350" y="585" class="label">是</text>
  <path d="M 370 585 L 320 585 L 320 610 L 300 610" class="arrow-green"/>
  <rect x="300" y="600" width="120" height="50" class="success" rx="5"/>
  <text x="360" y="620" text-anchor="middle" class="component">恢复Redis</text>
  <text x="360" y="635" text-anchor="middle" class="label">清空本地缓存</text>
  
  <!-- 等待下次检查 -->
  <text x="490" y="585" class="label">否</text>
  <path d="M 430 585 L 470 585 L 470 490 L 400 490 L 400 510" class="arrow"/>
  <text x="480" y="540" class="label">等待30秒后<br/>再次检查</text>
  
  <!-- 监控指标 -->
  <rect x="700" y="60" width="80" height="200" fill="#f5f5f5" rx="5"/>
  <text x="740" y="80" text-anchor="middle" class="subtitle">监控指标</text>
  
  <text x="710" y="100" class="label">连接状态:</text>
  <rect x="710" y="110" width="60" height="15" class="success" rx="2"/>
  <text x="740" y="121" text-anchor="middle" class="component" font-size="9">正常</text>
  
  <text x="710" y="140" class="label">失败次数:</text>
  <text x="740" y="155" text-anchor="middle" class="component" id="metricFailures">0</text>
  
  <text x="710" y="170" class="label">当前模式:</text>
  <text x="740" y="185" text-anchor="middle" class="component" id="currentMode">Redis</text>
  
  <text x="710" y="200" class="label">降级次数:</text>
  <text x="740" y="215" text-anchor="middle" class="component" id="fallbackCount">0</text>
  
  <text x="710" y="230" class="label">恢复次数:</text>
  <text x="740" y="245" text-anchor="middle" class="component" id="recoveryCount">0</text>
</svg>