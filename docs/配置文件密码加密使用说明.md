# é…ç½®æ–‡ä»¶å¯†ç åŠ å¯†åŠŸèƒ½ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨é…ç½®æ–‡ä»¶å¯†ç åŠ å¯†åŠŸèƒ½ï¼Œä¿æŠ¤æ•°æ®åº“å¯†ç ã€Rediså¯†ç ã€APIå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ã€‚

> **ğŸ“‹ æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **ğŸ“… æœ€åæ›´æ–°**: 2025-11-20  
> **ğŸ‘¨â€ğŸ’» ä½œè€…**: zhengbing  
> **ğŸ”’ å®‰å…¨ç­‰çº§**: å†›ç”¨çº§(AES-256-GCM)  

## ğŸš€ åŠŸèƒ½ä»‹ç»

æœ¬åŠŸèƒ½æä¾›äº†ä¸€å¥—å®Œæ•´çš„é…ç½®æ–‡ä»¶æ•æ„Ÿä¿¡æ¯åŠ å¯†è§£å†³æ–¹æ¡ˆï¼š

- **ğŸ” å¼ºåŠ å¯†ç®—æ³•**: ä½¿ç”¨AES-256-GCMå†›äº‹çº§åŠ å¯†ç®—æ³•ï¼Œç¡®ä¿æ•°æ®å®‰å…¨
- **âš¡ è‡ªåŠ¨è§£å¯†**: åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨è§£å¯†é…ç½®å€¼ï¼Œå¯¹ä¸šåŠ¡ä»£ç å®Œå…¨é€æ˜
- **ğŸ”„ å¯†é’¥ç®¡ç†**: æ”¯æŒå¯†é’¥è½®æ¢ã€å¤šç‰ˆæœ¬å¯†é’¥ç®¡ç†
- **ğŸŒ å¤šç¯å¢ƒæ”¯æŒ**: å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçµæ´»é…ç½®
- **âœ… åˆè§„æ”¯æŒ**: ç¬¦åˆOWASP Top 10ã€ISO 27001ç­‰å®‰å…¨æ ‡å‡†

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶åç§° | èŒè´£ | æ–‡ä»¶ä½ç½® |
|---------|------|----------|
| `EncryptUtil` | åŠ å¯†è§£å¯†æ ¸å¿ƒå·¥å…·ç±» | `com.bing.framework.security.EncryptUtil` |
| `EncryptedPropertyProcessor` | é…ç½®å±æ€§è‡ªåŠ¨è§£å¯†å¤„ç†å™¨ | `com.bing.framework.security.EncryptedPropertyProcessor` |
| `KeyManager` | å¯†é’¥ç®¡ç†æœåŠ¡ | `com.bing.framework.security.KeyManager` |
| `EncryptionAutoConfiguration` | Spring Bootè‡ªåŠ¨é…ç½®ç±» | `com.bing.framework.security.EncryptionAutoConfiguration` |

## ğŸ”§ å¿«é€Ÿå¼€å§‹

### 1. ç”ŸæˆåŠ å¯†å¯†é’¥

ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ç”Ÿæˆ256ä½åŠ å¯†å¯†é’¥ï¼š

```bash
# æ–¹æ³•1: ä½¿ç”¨Javaå‘½ä»¤ç›´æ¥è¿è¡ŒEncryptUtil
java -cp target/bing-framework-0.0.1-SNAPSHOT.jar com.bing.framework.security.EncryptUtil generateKey

# æ–¹æ³•2: åœ¨ä»£ç ä¸­ç”Ÿæˆ
String encryptionKey = EncryptUtil.generateKey();
System.out.println("åŠ å¯†å¯†é’¥: " + encryptionKey);
```

ç”Ÿæˆçš„å¯†é’¥ç¤ºä¾‹ï¼š
```
åŠ å¯†å¯†é’¥: 7Xt5Z2J8m9N3B6D1F4G7H2K5P8R0T3V6Y9A2C5E8G1J4L7N9Q2S5U8X0Z3B6E9H2K5P8R0T3V
```

### 2. åŠ å¯†æ•æ„Ÿé…ç½®å€¼

ä½¿ç”¨ç”Ÿæˆçš„å¯†é’¥åŠ å¯†éœ€è¦ä¿æŠ¤çš„æ•æ„Ÿä¿¡æ¯ï¼š

```bash
# åŠ å¯†æ•°æ®åº“å¯†ç ç¤ºä¾‹
java -cp target/bing-framework-0.0.1-SNAPSHOT.jar com.bing.framework.security.EncryptUtil encrypt "your-db-password" "your-encryption-key"

# åŠ å¯†ç»“æœç¤ºä¾‹
åŠ å¯†ç»“æœ: ENC(8Zx3J7M9P2Q5R8T1V4W6Y9B1D4F7H0J3L6N9Q2S5U8X0Z3B6E9H2K5P8R0T3V6Y9A2C5E)
```

### 3. é…ç½®åŠ å¯†å¯†é’¥

å°†ç”Ÿæˆçš„åŠ å¯†å¯†é’¥é…ç½®åˆ°åº”ç”¨ä¸­ï¼Œæ¨èä»¥ä¸‹æ–¹å¼ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰ï¼š

#### 3.1 ç¯å¢ƒå˜é‡æ–¹å¼ï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# Linux/Mac
 export ENCRYPTION_KEY="your-encryption-key"

# Windows
set ENCRYPTION_KEY="your-encryption-key"
```

#### 3.2 é…ç½®æ–‡ä»¶æ–¹å¼ï¼ˆæ¨èç”¨äºå¼€å‘ç¯å¢ƒï¼‰

åœ¨`application.yml`æˆ–`application.properties`ä¸­é…ç½®ï¼š

```yaml
# application.yml
app:
  encryption:
    key: your-encryption-key
```

#### 3.3 å¯†é’¥æ–‡ä»¶æ–¹å¼

```yaml
# application.yml
app:
  encryption:
    key-file: /path/to/encryption.key
```

### 4. åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨åŠ å¯†å€¼

å°†åŠ å¯†åçš„æ•æ„Ÿä¿¡æ¯ä»¥`ENC(åŠ å¯†å€¼)`æ ¼å¼é…ç½®åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼š

```yaml
# application-dev.yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/bing_framework
    username: root
    password: ENC(8Zx3J7M9P2Q5R8T1V4W6Y9B1D4F7H0J3L6N9Q2S5U8X0Z3B6E9H2K5P8R0T3V6Y9A2C5E)
  
  redis:
    host: localhost
    port: 6379
    password: ENC(9A2B5C8D1E4F7G0H3J6K9L2N5Q8R1T4V7W0Y3B6E9H2K5P8R0T3V6Y9A2C5E8G1J4L)

# JWTé…ç½®
jwt:
  secret: ENC(1D4F7H0J3L6N9Q2S5U8X0Z3B6E9H2K5P8R0T3V6Y9A2C5E8G1J4L7N9Q2S5U8X0Z3B6)
```

## ğŸŒ å¤šç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ

åœ¨`application-dev.yml`ä¸­å¯ä»¥ç›´æ¥é…ç½®åŠ å¯†å¯†é’¥å’Œè§£å¯†åçš„é…ç½®ï¼š

```yaml
# application-dev.yml
app:
  encryption:
    key: your-development-encryption-key

spring:
  datasource:
    password: ENC(encrypted-dev-password)
```

### æµ‹è¯•ç¯å¢ƒ

```yaml
# application-test.yml
app:
  encryption:
    key-file: classpath:test-encryption.key

spring:
  datasource:
    password: ENC(encrypted-test-password)
```

### ç”Ÿäº§ç¯å¢ƒ

ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–Kubernetes Secretsç®¡ç†å¯†é’¥ï¼š

#### Kubernetesç¯å¢ƒ

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: encryption-secrets
type: Opaque
data:
  encryption-key: <base64-encoded-encryption-key>
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: bing-framework
spec:
  template:
    spec:
      containers:
      - name: bing-framework
        image: your-image:latest
        env:
        - name: ENCRYPTION_KEY
          valueFrom:
            secretKeyRef:
              name: encryption-secrets
              key: encryption-key
```

## ğŸ’» ä»£ç ä¸­ä½¿ç”¨

### æ³¨å…¥ä½¿ç”¨åŠ å¯†å·¥å…·

```java
import com.bing.framework.security.EncryptUtil;
import com.bing.framework.security.KeyManager;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class YourService {
    
    @Autowired
    private EncryptUtil encryptUtil;
    
    @Autowired
    private KeyManager keyManager;
    
    public void someMethod() {
        // åŠ å¯†æ•°æ®
        String sensitiveData = "éœ€è¦åŠ å¯†çš„æ•°æ®";
        String encrypted = encryptUtil.encrypt(sensitiveData, keyManager.getActiveKey());
        
        // è§£å¯†æ•°æ®
        String decrypted = encryptUtil.decrypt(encrypted, keyManager.getActiveKey());
        
        // å¯†é’¥è½®æ¢
        // keyManager.rotateKey();
    }
}
```

### å‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨

```bash
# ç”Ÿæˆå¯†é’¥
java -cp app.jar com.bing.framework.security.EncryptUtil generateKey

# åŠ å¯†æ•°æ®
java -cp app.jar com.bing.framework.security.EncryptUtil encrypt "æ˜æ–‡æ•°æ®" "åŠ å¯†å¯†é’¥"

# è§£å¯†æ•°æ®
java -cp app.jar com.bing.framework.security.EncryptUtil decrypt "å¯†æ–‡æ•°æ®" "åŠ å¯†å¯†é’¥"
```

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### å¯†é’¥ç®¡ç†

1. **å®šæœŸè½®æ¢å¯†é’¥**ï¼šå»ºè®®æ¯90å¤©æ›´æ¢ä¸€æ¬¡åŠ å¯†å¯†é’¥
2. **å¯†é’¥å¤‡ä»½**ï¼šç¡®ä¿å¯†é’¥å®‰å…¨å¤‡ä»½ï¼Œé˜²æ­¢å¯†é’¥ä¸¢å¤±
3. **æƒé™æ§åˆ¶**ï¼šä¸¥æ ¼é™åˆ¶å¯†é’¥çš„è®¿é—®æƒé™
4. **ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒå¯†é’¥**ï¼šå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç‹¬ç«‹çš„å¯†é’¥

### éƒ¨ç½²å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒç¦æ­¢ç¡¬ç¼–ç å¯†é’¥**ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
2. **å¯†é’¥æ–‡ä»¶æƒé™**ï¼šå¦‚æœä½¿ç”¨å¯†é’¥æ–‡ä»¶ï¼Œç¡®ä¿æƒé™è®¾ç½®ä¸º600ï¼ˆä»…æ‰€æœ‰è€…å¯è¯»å†™ï¼‰
3. **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šä½¿ç”¨Kubernetes Secretsæˆ–Docker Secretsç®¡ç†å¯†é’¥
4. **ç›‘æ§å®¡è®¡**ï¼šè®°å½•å¹¶ç›‘æ§å¯†é’¥ä½¿ç”¨æƒ…å†µ

### å¸¸è§é—®é¢˜

#### 1. å¦‚ä½•æ£€æŸ¥åŠ å¯†é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ

æŸ¥çœ‹åº”ç”¨å¯åŠ¨æ—¥å¿—ï¼Œå¯»æ‰¾ä»¥ä¸‹æ—¥å¿—ä¿¡æ¯ï¼š
```
INFO  c.b.f.s.EncryptedPropertyProcessor - å¼€å§‹å¤„ç†åŠ å¯†é…ç½®å±æ€§...
INFO  c.b.f.s.EncryptedPropertyProcessor - ä»ç¯å¢ƒå˜é‡è·å–åŠ å¯†å¯†é’¥
INFO  c.b.f.s.EncryptedPropertyProcessor - æˆåŠŸè§£å¯† 3 ä¸ªé…ç½®å±æ€§
INFO  c.b.f.s.EncryptedPropertyProcessor - åŠ å¯†é…ç½®å±æ€§å¤„ç†å®Œæˆ
```

#### 2. å¯†é’¥ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ

å¦‚æœå¯†é’¥ä¸¢å¤±ï¼Œæ— æ³•è§£å¯†å·²åŠ å¯†çš„æ•°æ®ã€‚è¯·ç¡®ä¿ï¼š
- å¯†é’¥å®‰å…¨å¤‡ä»½
- å®æ–½å¯†é’¥è½®æ¢ç­–ç•¥
- å®šæœŸéªŒè¯å¯†é’¥å¯ç”¨æ€§

#### 3. å¦‚ä½•è¿›è¡Œå¯†é’¥è½®æ¢ï¼Ÿ

1. ç”Ÿæˆæ–°å¯†é’¥
2. æ›´æ–°å¯†é’¥é…ç½®ï¼ˆç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶ï¼‰
3. ä½¿ç”¨æ–°å¯†é’¥é‡æ–°åŠ å¯†æ‰€æœ‰æ•æ„Ÿä¿¡æ¯
4. é‡å¯åº”ç”¨ä½¿æ–°å¯†é’¥ç”Ÿæ•ˆ

## ğŸ“Š æ€§èƒ½å½±å“

- **å¯åŠ¨æ—¶é—´**ï¼šé¦–æ¬¡è§£å¯†ä¼šå¢åŠ çº¦50-100msçš„å¯åŠ¨æ—¶é—´
- **è¿è¡Œæ—¶**ï¼šè§£å¯†åçš„å€¼ä¼šç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯¹è¿è¡Œæ—¶æ€§èƒ½å‡ ä¹æ— å½±å“
- **å†…å­˜ä½¿ç”¨**ï¼šå¢åŠ å°‘é‡å†…å­˜å ç”¨ï¼ˆçº¦1-2MBï¼‰ç”¨äºå¯†é’¥å­˜å‚¨å’Œç¼“å­˜

## ğŸ›¡ï¸ å®‰å…¨å®¡è®¡

ç³»ç»Ÿä¼šè®°å½•ä»¥ä¸‹å®‰å…¨ç›¸å…³äº‹ä»¶ï¼š
- å¯†é’¥åŠ è½½æ–¹å¼å’Œæ¥æº
- è§£å¯†çš„é…ç½®å±æ€§æ•°é‡
- å¯†é’¥è½®æ¢äº‹ä»¶
- è§£å¯†å¤±è´¥å¼‚å¸¸

å®¡è®¡æ—¥å¿—ç¤ºä¾‹ï¼š
```
INFO  c.b.f.s.EncryptedPropertyProcessor - ä»ç¯å¢ƒå˜é‡è·å–åŠ å¯†å¯†é’¥
INFO  c.b.f.s.EncryptedPropertyProcessor - è§£å¯†é…ç½®å±æ€§: spring.datasource.pa****word
INFO  c.b.f.s.EncryptedPropertyProcessor - æˆåŠŸè§£å¯† 3 ä¸ªé…ç½®å±æ€§
INFO  c.b.f.s.KeyManager - å¯†é’¥è½®æ¢å®Œæˆï¼Œæ–°å¯†é’¥ç‰ˆæœ¬: v2
```

## ğŸ“ æ€»ç»“

é…ç½®æ–‡ä»¶å¯†ç åŠ å¯†åŠŸèƒ½æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„æ•æ„Ÿä¿¡æ¯ä¿æŠ¤æœºåˆ¶ï¼Œé€šè¿‡AES-256-GCMåŠ å¯†ç®—æ³•å’Œå®Œå–„çš„å¯†é’¥ç®¡ç†ï¼Œç¡®ä¿é…ç½®æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯å®‰å…¨ã€‚ä½¿ç”¨æœ¬åŠŸèƒ½å¯ä»¥æœ‰æ•ˆé˜²æ­¢é…ç½®æ–‡ä»¶æ³„éœ²å¯¼è‡´çš„å®‰å…¨é£é™©ï¼ŒåŒæ—¶ä¿æŒåº”ç”¨å¼€å‘å’Œéƒ¨ç½²çš„ä¾¿æ·æ€§ã€‚

---

**æ³¨æ„**ï¼šè¯·å¦¥å–„ä¿ç®¡åŠ å¯†å¯†é’¥ï¼Œå¯†é’¥ä¸¢å¤±å°†å¯¼è‡´æ— æ³•è§£å¯†å·²åŠ å¯†çš„æ•°æ®ã€‚

**è”ç³»æ–¹å¼**ï¼šå¦‚åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ”¯æŒã€‚