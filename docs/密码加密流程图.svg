<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 2200" width="1400" height="2200">
  <defs>
    <style>
      .title-text { font-family: 'Microsoft YaHei', Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #2c3e50; }
      .section-title { font-family: 'Microsoft YaHei', Arial, sans-serif; font-size: 20px; font-weight: bold; fill: #34495e; }
      .box-text { font-family: 'Microsoft YaHei', Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #2c3e50; }
      .small-text { font-family: 'Microsoft YaHei', Arial, sans-serif; font-size: 12px; fill: #7f8c8d; }
      .arrow { stroke: #3498db; stroke-width: 2; fill: none; }
      .arrow-reverse { stroke: #e74c3c; stroke-width: 2; fill: none; }
      .box-white { fill: white; stroke: #34495e; stroke-width: 2; rx: 8; }
      .box-blue { fill: #3498db; stroke: #2980b9; stroke-width: 2; rx: 8; }
      .box-green { fill: #2ecc71; stroke: #27ae60; stroke-width: 2; rx: 8; }
      .box-orange { fill: #f39c12; stroke: #e67e22; stroke-width: 2; rx: 8; }
      .box-red { fill: #e74c3c; stroke: #c0392b; stroke-width: 2; rx: 8; }
      .box-purple { fill: #9b59b6; stroke: #8e44ad; stroke-width: 2; rx: 8; }
      .box-cyan { fill: #1abc9c; stroke: #16a085; stroke-width: 2; rx: 8; }
    </style>
    
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3498db" />
    </marker>
    <marker id="arrowhead-reverse" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="10 0, 0 3.5, 10 7" fill="#e74c3c" />
    </marker>
  </defs>

  <!-- 标题 -->
  <text x="700" y="40" class="title-text" text-anchor="middle">🔐 密码加密技术流程图 - SVG版本</text>

  <!-- 1. 总体架构流程 -->
  <g id="architecture-flow">
    <text x="700" y="80" class="section-title" text-anchor="middle">1. 总体架构流程</text>
    
    <!-- 敏感配置数据 -->
    <rect x="50" y="120" width="150" height="60" class="box-white"/>
    <text x="125" y="145" class="box-text" text-anchor="middle">敏感配置数据</text>
    <text x="125" y="165" class="small-text" text-anchor="middle">(明文密码)</text>
    
    <!-- 箭头1 -->
    <line x1="200" y1="150" x2="250" y2="150" class="arrow" marker-end="url(#arrowhead)"/>
    <text x="225" y="140" class="small-text" text-anchor="middle" fill="#3498db">加密</text>
    
    <!-- AES-GCM加密 -->
    <rect x="250" y="120" width="150" height="60" class="box-blue"/>
    <text x="325" y="145" class="box-text" text-anchor="middle" fill="white">AES-GCM加密</text>
    <text x="325" y="165" class="small-text" text-anchor="middle" fill="white">(256位密钥)</text>
    
    <!-- 箭头2 -->
    <line x1="400" y1="150" x2="450" y2="150" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 加密后数据 -->
    <rect x="450" y="120" width="150" height="60" class="box-white"/>
    <text x="525" y="145" class="box-text" text-anchor="middle">加密后数据</text>
    <text x="525" y="165" class="small-text" text-anchor="middle">(密文+IV)</text>
    
    <!-- 箭头3 -->
    <line x1="600" y1="150" x2="650" y2="150" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 配置文件存储 -->
    <rect x="650" y="120" width="150" height="60" class="box-white"/>
    <text x="725" y="145" class="box-text" text-anchor="middle">配置文件存储</text>
    <text x="725" y="165" class="small-text" text-anchor="middle">(ENC()格式)</text>
    
    <!-- 下箭头 -->
    <line x1="725" y1="180" x2="725" y2="230" class="arrow"/>
    <text x="745" y="210" class="small-text" fill="#3498db">↓</text>
    
    <!-- 读取配置文件 -->
    <rect x="650" y="230" width="150" height="60" class="box-white"/>
    <text x="725" y="255" class="box-text" text-anchor="middle">读取配置文件</text>
    <text x="725" y="275" class="small-text" text-anchor="middle">(application.yml)</text>
    
    <!-- 箭头左3 -->
    <line x1="650" y1="260" x2="600" y2="260" class="arrow-reverse" marker-end="url(#arrowhead-reverse)"/>
    
    <!-- 解析ENC()格式 -->
    <rect x="450" y="230" width="150" height="60" class="box-white"/>
    <text x="525" y="250" class="box-text" text-anchor="middle">解析ENC()格式</text>
    <text x="525" y="270" class="small-text" text-anchor="middle">(分离IV+密文)</text>
    
    <!-- 箭头左2 -->
    <line x1="450" y1="260" x2="400" y2="260" class="arrow-reverse" marker-end="url(#arrowhead-reverse)"/>
    
    <!-- AES-GCM解密 -->
    <rect x="250" y="230" width="150" height="60" class="box-red"/>
    <text x="325" y="255" class="box-text" text-anchor="middle" fill="white">AES-GCM解密</text>
    <text x="325" y="275" class="small-text" text-anchor="middle" fill="white">(256位密钥)</text>
    
    <!-- 箭头左1 -->
    <line x1="250" y1="260" x2="200" y2="260" class="arrow-reverse" marker-end="url(#arrowhead-reverse)"/>
    
    <!-- 业务逻辑使用 -->
    <rect x="50" y="230" width="150" height="60" class="box-white"/>
    <text x="125" y="255" class="box-text" text-anchor="middle">业务逻辑使用</text>
    <text x="125" y="275" class="small-text" text-anchor="middle">(内存明文)</text>
  </g>

  <!-- 2. 密钥派生流程 -->
  <g id="key-derivation">
    <text x="700" y="360" class="section-title" text-anchor="middle">2. 密钥派生流程</text>
    
    <!-- 用户密码 -->
    <rect x="50" y="400" width="150" height="60" class="box-orange"/>
    <text x="125" y="425" class="box-text" text-anchor="middle" fill="white">用户密码</text>
    <text x="125" y="445" class="small-text" text-anchor="middle" fill="white">(明文)</text>
    
    <!-- 箭头 -->
    <line x1="200" y1="430" x2="250" y2="430" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- PBKDF2 -->
    <rect x="250" y="400" width="150" height="60" class="box-purple"/>
    <text x="325" y="425" class="box-text" text-anchor="middle" fill="white">PBKDF2</text>
    <text x="325" y="445" class="small-text" text-anchor="middle" fill="white">(100,000次迭代)</text>
    
    <!-- 箭头 -->
    <line x1="400" y1="430" x2="450" y2="430" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 随机盐值 -->
    <rect x="50" y="490" width="150" height="60" class="box-cyan"/>
    <text x="125" y="515" class="box-text" text-anchor="middle" fill="white">随机盐值</text>
    <text x="125" y="535" class="small-text" text-anchor="middle" fill="white">(32字节)</text>
    
    <!-- 箭头到PBKDF2 -->
    <line x1="125" y1="490" x2="325" y2="460" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 派生密钥 -->
    <rect x="450" y="400" width="150" height="60" class="box-green"/>
    <text x="525" y="425" class="box-text" text-anchor="middle" fill="white">派生密钥</text>
    <text x="525" y="445" class="small-text" text-anchor="middle" fill="white">(256位AES密钥)</text>
    
    <!-- 箭头到加密 -->
    <line x1="600" y1="430" x2="650" y2="430" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- AES加密 -->
    <rect x="650" y="400" width="150" height="60" class="box-blue"/>
    <text x="725" y="425" class="box-text" text-anchor="middle" fill="white">AES加密</text>
    <text x="725" y="445" class="small-text" text-anchor="middle" fill="white">(使用派生密钥)</text>
  </g>

  <!-- 3. AES-GCM加密处理 -->
  <g id="aes-gcm-encryption">
    <text x="700" y="640" class="section-title" text-anchor="middle">3. AES-GCM加密处理</text>
    
    <!-- 明文数据 -->
    <rect x="50" y="680" width="150" height="60" class="box-white"/>
    <text x="125" y="705" class="box-text" text-anchor="middle">明文数据</text>
    <text x="125" y="725" class="small-text" text-anchor="middle">(配置密码)</text>
    
    <!-- 箭头 -->
    <line x1="200" y1="710" x2="250" y2="710" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- AES密钥 -->
    <rect x="250" y="680" width="150" height="60" class="box-green"/>
    <text x="325" y="705" class="box-text" text-anchor="middle" fill="white">AES密钥</text>
    <text x="325" y="725" class="small-text" text-anchor="middle" fill="white">(256位)</text>
    
    <!-- 箭头到GCM -->
    <line x1="400" y1="710" x2="450" y2="710" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 随机IV -->
    <rect x="450" y="620" width="150" height="60" class="box-cyan"/>
    <text x="525" y="645" class="box-text" text-anchor="middle" fill="white">随机IV</text>
    <text x="525" y="665" class="small-text" text-anchor="middle" fill="white">(12字节)</text>
    
    <!-- AES-GCM加密 -->
    <rect x="450" y="680" width="150" height="60" class="box-blue"/>
    <text x="525" y="705" class="box-text" text-anchor="middle" fill="white">AES-GCM加密</text>
    <text x="525" y="725" class="small-text" text-anchor="middle" fill="white">认证加密</text>
    
    <!-- 箭头到输出 -->
    <line x1="600" y1="710" x2="650" y2="710" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 输出：密文+认证标签 -->
    <rect x="650" y="680" width="150" height="60" class="box-purple"/>
    <text x="725" y="700" class="box-text" text-anchor="middle" fill="white">密文</text>
    <text x="725" y="720" class="small-text" text-anchor="middle" fill="white">+</text>
    <text x="725" y="735" class="small-text" text-anchor="middle" fill="white">认证标签</text>
  </g>

  <!-- 4. Spring Boot配置解析流程 -->
  <g id="spring-boot-config">
    <text x="700" y="880" class="section-title" text-anchor="middle">4. Spring Boot配置解析流程</text>
    
    <!-- 启动应用 -->
    <rect x="50" y="920" width="150" height="60" class="box-green"/>
    <text x="125" y="945" class="box-text" text-anchor="middle" fill="white">启动应用</text>
    <text x="125" y="965" class="small-text" text-anchor="middle" fill="white">Spring Boot</text>
    
    <!-- 箭头 -->
    <line x1="200" y1="950" x2="250" y2="950" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 加载配置文件 -->
    <rect x="250" y="920" width="150" height="60" class="box-white"/>
    <text x="325" y="945" class="box-text" text-anchor="middle">加载配置文件</text>
    <text x="325" y="965" class="small-text" text-anchor="middle">application.yml</text>
    
    <!-- 箭头 -->
    <line x1="400" y1="950" x2="450" y2="950" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 检测ENC()格式 -->
    <rect x="450" y="920" width="150" height="60" class="box-orange"/>
    <text x="525" y="940" class="box-text" text-anchor="middle" fill="white">检测ENC()格式</text>
    <text x="525" y="960" class="small-text" text-anchor="middle" fill="white">解析密文</text>
    
    <!-- 箭头 -->
    <line x1="600" y1="950" x2="650" y2="950" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 调用解密服务 -->
    <rect x="650" y="920" width="150" height="60" class="box-blue"/>
    <text x="725" y="945" class="box-text" text-anchor="middle" fill="white">调用解密服务</text>
    <text x="725" y="965" class="small-text" text-anchor="middle" fill="white">PasswordDecoder</text>
    
    <!-- 下箭头 -->
    <line x1="725" y1="980" x2="725" y2="1030" class="arrow"/>
    <text x="745" y="1010" class="small-text" fill="#3498db">↓</text>
    
    <!-- 返回明文 -->
    <rect x="650" y="1030" width="150" height="60" class="box-green"/>
    <text x="725" y="1055" class="box-text" text-anchor="middle" fill="white">返回明文</text>
    <text x="725" y="1075" class="small-text" text-anchor="middle" fill="white">配置注入</text>
  </g>

  <!-- 5. 配置文件生命周期管理 -->
  <g id="config-lifecycle">
    <text x="700" y="1160" class="section-title" text-anchor="middle">5. 配置文件生命周期管理</text>
    
    <!-- 创建配置文件 -->
    <rect x="50" y="1200" width="150" height="60" class="box-green"/>
    <text x="125" y="1225" class="box-text" text-anchor="middle" fill="white">创建配置文件</text>
    <text x="125" y="1245" class="small-text" text-anchor="middle" fill="white">开发阶段</text>
    
    <!-- 箭头 -->
    <line x1="200" y1="1230" x2="250" y2="1230" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 明文密码 -->
    <rect x="250" y="1200" width="150" height="60" class="box-white"/>
    <text x="325" y="1225" class="box-text" text-anchor="middle">明文密码</text>
    <text x="325" y="1245" class="small-text" text-anchor="middle">敏感信息</text>
    
    <!-- 箭头 -->
    <line x1="400" y1="1230" x2="450" y2="1230" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 加密处理 -->
    <rect x="450" y="1200" width="150" height="60" class="box-blue"/>
    <text x="525" y="1225" class="box-text" text-anchor="middle" fill="white">加密处理</text>
    <text x="525" y="1245" class="small-text" text-anchor="middle" fill="white">ENC()包装</text>
    
    <!-- 箭头 -->
    <line x1="600" y1="1230" x2="650" y2="1230" class="arrow" marker-end="url(#arrowhead)"/>
    
    <!-- 安全存储 -->
    <rect x="650" y="1200" width="150" height="60" class="box-purple"/>
    <text x="725" y="1225" class="box-text" text-anchor="middle" fill="white">安全存储</text>
    <text x="725" y="1245" class="small-text" text-anchor="middle" fill="white">版本控制</text>
    
    <!-- 向下分支 -->
    <line x1="725" y1="1260" x2="725" y2="1310" class="arrow"/>
    <text x="745" y="1290" class="small-text" fill="#3498db">↓</text>
    
    <!-- 部署阶段 -->
    <rect x="650" y="1310" width="150" height="60" class="box-orange"/>
    <text x="725" y="1335" class="box-text" text-anchor="middle" fill="white">部署阶段</text>
    <text x="725" y="1355" class="small-text" text-anchor="middle" fill="white">生产环境</text>
    
    <!-- 向左箭头 -->
    <line x1="650" y1="1340" x2="600" y2="1340" class="arrow-reverse" marker-end="url(#arrowhead-reverse)"/>
    
    <!-- 读取解密 -->
    <rect x="450" y="1310" width="150" height="60" class="box-red"/>
    <text x="525" y="1335" class="box-text" text-anchor="middle" fill="white">读取解密</text>
    <text x="525" y="1355" class="small-text" text-anchor="middle" fill="white">自动解密</text>
    
    <!-- 向左箭头 -->
    <line x1="450" y1="1340" x2="400" y2="1340" class="arrow-reverse" marker-end="url(#arrowhead-reverse)"/>
    
    <!-- 运行时使用 -->
    <rect x="250" y="1310" width="150" height="60" class="box-green"/>
    <text x="325" y="1335" class="box-text" text-anchor="middle" fill="white">运行时使用</text>
    <text x="325" y="1355" class="small-text" text-anchor="middle" fill="white">内存明文</text>
    
    <!-- 向左箭头 -->
    <line x1="250" y1="1340" x2="200" y2="1340" class="arrow-reverse" marker-end="url(#arrowhead-reverse)"/>
    
    <!-- 应用启动 -->
    <rect x="50" y="1310" width="150" height="60" class="box-cyan"/>
    <text x="125" y="1335" class="box-text" text-anchor="middle" fill="white">应用启动</text>
    <text x="125" y="1355" class="small-text" text-anchor="middle" fill="white">配置加载</text>
  </g>

  <!-- 技术说明 -->
  <g id="tech-notes">
    <text x="700" y="1450" class="section-title" text-anchor="middle">🔧 技术要点说明</text>
    
    <text x="100" y="1480" class="small-text">• AES-256-GCM: 提供加密和认证双重保护</text>
    <text x="100" y="1500" class="small-text">• PBKDF2: 使用100,000次迭代增强密钥强度</text>
    <text x="100" y="1520" class="small-text">• 随机盐值: 防止彩虹表攻击</text>
    <text x="100" y="1540" class="small-text">• IV随机化: 确保相同明文产生不同密文</text>
    <text x="100" y="1560" class="small-text">• ENC()格式: 统一加密数据包装标准</text>
    <text x="100" y="1580" class="small-text">• 自动解密: 运行时无缝解密配置</text>
    <text x="100" y="1600" class="small-text">• 密钥管理: 支持环境变量和配置文件</text>
    
    <text x="700" y="1640" class="section-title" text-anchor="middle">⚡ 性能优化建议</text>
    
    <text x="100" y="1670" class="small-text">• 缓存解密结果: 避免重复解密操作</text>
    <text x="100" y="1690" class="small-text">• 密钥预热: 应用启动时预加载常用密钥</text>
    <text x="100" y="1710" class="small-text">• 批量处理: 支持批量加密解密操作</text>
    <text x="100" y="1730" class="small-text">• 异步处理: 大数据量时使用异步解密</text>
    
    <text x="700" y="1770" class="section-title" text-anchor="middle">🛡️ 安全性最佳实践</text>
    
    <text x="100" y="1800" class="small-text">• 密钥分离: 不同环境使用不同密钥</text>
    <text x="100" y="1820" class="small-text">• 定期轮换: 定期更新加密密钥</text>
    <text x="100" y="1840" class="small-text">• 访问控制: 限制解密服务的访问权限</text>
    <text x="100" y="1860" class="small-text">• 审计日志: 记录所有加密解密操作</text>
    <text x="100" y="1880" class="small-text">• 内存清理: 及时清理内存中的敏感数据</text>
    
    <text x="700" y="1920" class="section-title" text-anchor="middle">📊 配置示例</text>
    
    <rect x="100" y="1940" width="1200" height="200" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1" rx="5"/>
    
    <text x="120" y="1970" class="small-text" font-family="monospace"># application.yml 配置示例</text>
    <text x="120" y="1990" class="small-text" font-family="monospace">spring:</text>
    <text x="140" y="2010" class="small-text" font-family="monospace">datasource:</text>
    <text x="160" y="2030" class="small-text" font-family="monospace">password: ENC(g4J9K2mN8xQ+3vL5wE7sA==)</text>
    <text x="140" y="2050" class="small-text" font-family="monospace">redis:</text>
    <text x="160" y="2070" class="small-text" font-family="monospace">password: ENC(z1M5nB8kL2pQ9sR4tU6vX==)</text>
    <text x="120" y="2090" class="small-text" font-family="monospace"># 自定义配置</text>
    <text x="140" y="2110" class="small-text" font-family="monospace">app:</text>
    <text x="160" y="2130" class="small-text" font-family="monospace">api-key: ENC(a7B3cD9eF2hI5jK8mN1pQ==)</text>
  </g>

  <!-- 页脚信息 -->
  <text x="700" y="2170" class="small-text" text-anchor="middle" fill="#7f8c8d">
    🔐 密码加密技术流程图 | 生成时间: 2025-11-20 | 作者: zhengbing
  </text>
</svg>