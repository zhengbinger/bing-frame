# 权限数据重新生成说明文档

## 概述

基于项目现有的12个控制器模块，重新设计并生成了完整的权限数据。该权限体系采用RBAC（Role-Based Access Control）模型，支持灵活的角色权限分配。

## 权限体系结构

### 1. 权限分层设计

- **菜单权限**：顶级模块，如"用户管理"、"角色管理"等
- **功能权限**：具体的业务功能，如"用户列表"、"创建用户"等
- **操作权限**：具体的增删改查操作，对应具体的HTTP接口

### 2. 权限类型说明

- **type = 0**：菜单权限（父级权限）
- **type = 1**：按钮权限（前端按钮控制）
- **type = 2**：接口权限（后端API权限控制）

## 权限模块覆盖

| 模块名称 | 权限编码前缀 | 权限点数量 | 主要功能 |
|---------|-------------|-----------|----------|
| 认证管理 | auth | 6个 | 登录、注册、注销、用户信息、令牌刷新 |
| 用户管理 | user | 15个 | 用户CRUD、密码管理、状态管理、角色分配 |
| 角色管理 | role | 12个 | 角色CRUD、状态管理、权限分配、用户分配 |
| 权限管理 | permission | 9个 | 权限CRUD、状态管理、树形展示 |
| 组织管理 | organization | 8个 | 组织CRUD、树形结构、关联检查 |
| 用户组织关联 | user-organization | 6个 | 用户与组织关联管理 |
| 数据字典 | data-dict | 8个 | 字典CRUD、状态管理 |
| 字典项管理 | data-dict-item | 8个 | 字典项CRUD、状态管理 |
| 系统配置 | system-config | 6个 | 配置CRUD、批量更新 |
| 登录记录 | login-record | 5个 | 登录日志查看、清理 |
| 白名单管理 | white-list | 6个 | 白名单CRUD |
| 验证码管理 | captcha | 3个 | 验证码生成、刷新、验证 |
| 国际化测试 | i18n | 1个 | 国际化功能测试 |

**总计：97个权限点**

## 角色体系定义

### 1. 系统管理员 (ADMIN)
- **权限范围**：拥有系统所有权限
- **适用场景**：系统维护、全局管理

### 2. 普通用户 (USER)
- **权限范围**：基本使用权限
- **主要权限**：
  - 认证相关：登录、注销、查看个人信息
  - 个人信息管理：查看和更新自己的信息、修改密码
  - 只读权限：查看数据字典、系统信息
- **适用场景**：一般业务用户

### 3. 部门管理员 (DEPT_ADMIN)
- **权限范围**：部门内用户管理
- **主要权限**：
  - 用户管理：增删改查用户（除密码重置）
  - 角色管理：查看角色信息
  - 组织管理：查看组织架构
  - 用户组织关联：管理用户组织关系
- **适用场景**：部门负责人、团队leader

### 4. 财务管理员 (FINANCE_ADMIN)
- **权限范围**：财务相关查看权限
- **主要权限**：
  - 用户查看：查看用户基本信息
  - 登录记录：查看登录日志、失败记录
  - 组织查看：查看组织架构
- **适用场景**：财务人员、审计人员

### 5. 人事管理员 (HR_ADMIN)
- **权限范围**：人事相关管理权限
- **主要权限**：
  - 完整的用户管理权限（包含密码重置）
  - 组织管理权限
  - 用户组织关联管理权限
  - 数据字典管理权限
- **适用场景**：HR人员、人事专员

### 6. 审计员 (AUDITOR)
- **权限范围**：只读权限
- **主要权限**：
  - 查看所有模块的只读权限
  - 查看操作日志、登录记录
  - 系统配置查看
- **适用场景**：内部审计、合规检查

### 7. 访客 (GUEST)
- **权限范围**：最基本查看权限
- **主要权限**：
  - 基本认证：登录、查看个人信息
  - 只读权限：用户列表、组织列表、字典列表
- **适用场景**：临时访客、外部合作方

## 数据库表关系

```sql
-- 用户表 (user)
user_id -> user_role (多对多)
user_id -> user_organization (多对多)

-- 角色表 (role)
role_id -> user_role (多对多)
role_id -> role_permission (多对多)

-- 权限表 (permission)
permission_id -> role_permission (多对多)

-- 组织表 (organization)
organization_id -> user_organization (多对多)
```

## 使用方法

### 1. 执行脚本

```sql
-- 直接执行SQL脚本
source d:\ai_code\cursor\bing-framework\docs\permission_data_rebuild.sql;
```

### 2. 为用户分配角色

```sql
-- 为用户ID为1的用户分配系统管理员角色
INSERT INTO user_role (user_id, role_id) VALUES (1, 1);

-- 为用户ID为2的用户分配普通用户角色
INSERT INTO user_role (user_id, role_id) VALUES (2, 2);
```

### 3. 查询用户权限

```sql
-- 查询用户ID为1的所有权限
SELECT DISTINCT p.* 
FROM permission p
INNER JOIN role_permission rp ON p.id = rp.permission_id
INNER JOIN role r ON rp.role_id = r.id
INNER JOIN user_role ur ON r.id = ur.role_id
WHERE ur.user_id = 1 AND p.status = 1;
```

## 前端权限控制建议

### 1. 菜单控制
- 根据用户权限动态生成菜单
- 前端路由守卫检查菜单权限

### 2. 按钮控制
- 使用v-if指令控制按钮显示
- 权限点格式：`模块:功能:操作`

### 3. 页面控制
- 路由元信息配置权限要求
- 页面进入前检查权限

## 注意事项

1. **权限点一致性**：确保前端权限点与后端权限点保持一致
2. **安全性**：敏感操作需要多重权限验证
3. **权限缓存**：建议对用户权限进行缓存，提高性能
4. **权限审计**：定期检查权限分配是否合理
5. **新增权限**：新增功能时需要同步更新权限点

## 扩展建议

1. **数据权限**：可以进一步扩展数据权限控制
2. **动态权限**：支持运行时动态添加权限点
3. **权限审批**：敏感权限分配需要审批流程
4. **权限继承**：支持权限的继承关系
5. **临时权限**：支持临时权限的分配和回收

---

**创建时间**：2025-11-16  
**作者**：zhengbing  
**版本**：v1.0